<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Connect - Play on Another Device</title>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>
<body>
    <h1>Spotify Connect: Play on Another Device</h1>
    <button id="connect">Connect to Spotify</button>
    <button id="getDevices" style="display: none;">Get Devices</button>
    <ul id="devices" style="display: none;"></ul>
    <script>
        const clientId = "434bd41d2b3d470f9e1ede205a46fd4b"; // Replace with your Spotify Client ID
        const redirectUri = "https://soundscapestreams.github.io/pl-landinpages/"; // Replace with your Redirect URI
        const playlistUri = "spotify:playlist:6nn8clDGaeRneVhrRe92GC"; // Replace with your playlist URI
        let accessToken;

        // Step 1: Redirect to Spotify for Authentication
        document.getElementById('connect').addEventListener('click', () => {
            const scopes = 'streaming user-read-private user-modify-playback-state';
            const authUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;
            window.location.href = authUrl;
        });

        // Step 2: Extract Access Token from URL
        window.onload = () => {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            accessToken = params.get('access_token');

            if (accessToken) {
                document.getElementById('connect').style.display = 'none';
                document.getElementById('getDevices').style.display = 'block';
            }
        };

        // Step 3: Get Available Devices
        document.getElementById('getDevices').addEventListener('click', async () => {
            const response = await fetch('https://api.spotify.com/v1/me/player/devices', {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                displayDevices(data.devices);
            } else {
                console.error('Failed to fetch devices:', await response.json());
            }
        });

        // Step 4: Display Devices in a List
        function displayDevices(devices) {
            const deviceList = document.getElementById('devices');
            deviceList.innerHTML = '';

            devices.forEach(device => {
                const li = document.createElement('li');
                li.textContent = `${device.name} (${device.type})`;
                li.style.cursor = 'pointer';
                li.addEventListener('click', () => playOnDevice(device.id));
                deviceList.appendChild(li);
            });

            deviceList.style.display = 'block';
        }

        // Step 5: Play the Playlist on Selected Device
        async function playOnDevice(device_id) {
            const playEndpoint = `https://api.spotify.com/v1/me/player/play?device_id=${device_id}`;
            const response = await fetch(playEndpoint, {
                method: 'PUT',
                body: JSON.stringify({ context_uri: playlistUri }),
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                }
            });

            if (response.ok) {
                console.log('Playback started on device:', device_id);
            } else {
                console.error('Failed to start playback:', await response.json());
            }
        }
    </script>
</body>
</html>
